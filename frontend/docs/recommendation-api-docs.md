# 精酿推荐系统 API 接口文档

## 概述

本文档描述了精酿推荐系统的推荐接口，包括接口URL、请求方法、请求参数、响应格式和错误码说明。

## 接口信息

### 基本信息

- **接口名称**: 精酿啤酒推荐接口
- **接口URL**: `/recommend`
- **请求方法**: `POST`
- **Content-Type**: `application/json`

### 完整URL示例

```
POST http://localhost:8000/recommend
```

## 请求参数

### 可见参数（用户填写）

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| mood | String | 是 | 用户心情状态 | "放松"、"兴奋"、"疲惫" |
| taste | String | 是 | 用户口味偏好 | "甜"、"苦"、"酸"、"平衡"、"清爽"、"浓郁"、"果香"、"花香"、"麦香" |
| hop | String | 否 | 酒花偏好（进阶模式） | "柑橘味、热带水果味"、"松针味、松脂味" |
| style | String | 否 | 精酿风格偏好（进阶模式） | "IPA"、"世涛"、"酸艾尔"、"拉格" |
| scenario | String | 否 | 使用场景 | "relax"、"explore"、"pairing" |
| familiarity | String | 否 | 用户熟悉度 | "beginner"、"advanced" |

### 隐藏参数（系统自动推断）

以下参数仅在用户选择「新手」模式时，由前端根据用户输入自动推断，不显示在用户界面中：

| 参数名 | 类型 | 说明 | 推断逻辑 |
|--------|------|------|----------|
| hop | String | 酒花偏好 | 根据用户口味偏好自动推断 |
| style | String | 精酿风格偏好 | 根据用户心情状态自动推断 |
| ibu | String | 酒花苦度（IBU值范围） | 根据用户口味偏好自动推断 |
| aroma | Integer | 香气强度（1-5级评分） | 根据用户口味偏好自动推断 |

#### 隐藏参数推断规则

##### 1. 酒花偏好（hop）推断

根据用户口味偏好推断酒花香气类型：

| 用户口味 | 推断酒花偏好 |
|----------|--------------|
| 甜 | 柑橘味、热带水果味 |
| 苦 | 松针味、松脂味 |
| 酸 | 花香、果香 |
| 平衡 | 温和的柑橘味、花香 |
| 清爽 | 柠檬味、青柠味 |
| 浓郁 | 松脂味、热带水果味 |
| 果香 | 热带水果味、柑橘味 |
| 花香 | 花香、柑橘味 |
| 麦香 | 温和的酒花香气 |

##### 2. 精酿风格（style）推断

根据用户心情状态推断精酿风格：

| 用户心情 | 推断精酿风格 |
|----------|--------------|
| 放松 | 小麦啤、比利时白啤 |
| 兴奋 | IPA、美式艾尔 |
| 疲惫 | 拉格、皮尔森 |
| 开心 | 小麦啤、水果艾尔 |
| 忧郁 | 世涛、波特 |
| 平静 | 拉格、皮尔森 |
| 冒险 | IPA、酸艾尔 |
| 舒适 | 小麦啤、比利时白啤 |
| 社交 | 拉格、小麦啤 |
| 独处 | 世涛、IPA |

##### 3. 酒花苦度（ibu）推断

根据用户口味偏好推断IBU值范围：

| 用户口味 | 推断IBU范围 |
|----------|-------------|
| 甜 | 10-25 |
| 苦 | 40-70 |
| 酸 | 15-30 |
| 平衡 | 20-40 |
| 清爽 | 10-20 |
| 浓郁 | 50-80 |
| 果香 | 20-35 |
| 花香 | 25-45 |
| 麦香 | 15-30 |

##### 4. 香气强度（aroma）推断

根据用户口味偏好推断香气强度（1-5级）：

| 用户口味 | 推断香气强度 |
|----------|--------------|
| 甜 | 3 |
| 苦 | 4 |
| 酸 | 3 |
| 平衡 | 2 |
| 清爽 | 2 |
| 浓郁 | 5 |
| 果香 | 4 |
| 花香 | 4 |
| 麦香 | 2 |

## 请求示例

### 新手模式请求示例

```json
{
  "mood": "放松",
  "taste": "甜",
  "hop": "柑橘味、热带水果味",
  "style": "小麦啤、比利时白啤",
  "ibu": "10-25",
  "aroma": 3,
  "scenario": "relax",
  "familiarity": "beginner"
}
```

### 进阶模式请求示例

```json
{
  "mood": "兴奋",
  "taste": "苦",
  "hop": "松针味、松脂味",
  "style": "IPA",
  "scenario": "relax",
  "familiarity": "advanced"
}
```

## 响应格式

### 成功响应

**HTTP状态码**: 200

**响应体**:

```json
{
  "success": true,
  "recommendations": [
    {
      "name": "精酿啤酒名称",
      "brewery": "酒厂名称",
      "style": "精酿风格",
      "abv": "酒精度数",
      "volume": "容量",
      "price": "价格",
      "reason": "推荐理由",
      "conclusion": "推荐结论（20-30字）",
      "match_reason": "匹配分析",
      "drinking_scenario": "饮用场景"
    }
  ],
  "user_input": {
    "mood": "用户心情",
    "taste": "用户口味偏好"
  },
  "inferred_params": {
    "hop": "推断的酒花偏好",
    "style": "推断的精酿风格",
    "ibu": "推断的IBU范围",
    "aroma": "推断的香气强度"
  }
}
```

### 响应字段说明

| 字段名 | 类型 | 说明 |
|--------|------|------|
| success | Boolean | 请求是否成功 |
| recommendations | Array | 推荐的精酿啤酒列表 |
| recommendations[].name | String | 精酿啤酒名称 |
| recommendations[].brewery | String | 酒厂名称 |
| recommendations[].style | String | 精酿风格 |
| recommendations[].abv | String | 酒精度数 |
| recommendations[].volume | String | 容量 |
| recommendations[].price | String | 价格 |
| recommendations[].reason | String | 推荐理由 |
| recommendations[].conclusion | String | 推荐结论（20-30字） |
| recommendations[].match_reason | String | 匹配分析 |
| recommendations[].drinking_scenario | String | 饮用场景 |
| user_input | Object | 用户输入信息 |
| user_input.mood | String | 用户心情状态 |
| user_input.taste | String | 用户口味偏好 |
| inferred_params | Object | 系统推断的参数（仅新手模式） |
| inferred_params.hop | String | 推断的酒花偏好 |
| inferred_params.style | String | 推断的精酿风格 |
| inferred_params.ibu | String | 推断的IBU范围 |
| inferred_params.aroma | Integer | 推断的香气强度 |

### 推荐结论字段说明

**字段名**: `conclusion`  
**类型**: String  
**长度限制**: 20-30字  
**位置**: 显示在酒款标题下方、价格信息上方  
**样式**: 高亮显示，明显高于普通正文  
**作用**: 快速传达"是否适合用户"的一句话推荐总结

**展示效果**:
- 背景：深棕色渐变（#4b230e 到 #6b3d1e）
- 文字颜色：白色
- 字体大小：1.1rem
- 字体粗细：700（加粗）
- 图标：💡 灯泡图标
- 动画：微光闪烁效果

**示例**:
- "这款IPA苦度适中，非常适合放松时饮用"
- "小麦啤清爽甘甜，完美契合您的口味偏好"
- "世涛浓郁醇厚，适合疲惫时慢慢品味"

## 错误码说明

### HTTP状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 错误响应示例

**HTTP状态码**: 400

**响应体**:

```json
{
  "success": false,
  "error": "请求参数错误",
  "message": "心情状态和口味偏好为必填项"
}
```

**HTTP状态码**: 500

**响应体**:

```json
{
  "success": false,
  "error": "服务器内部错误",
  "message": "处理请求时发生错误"
}
```

## 边界条件处理

### 前端边界条件

1. **参数验证**:
   - 心情状态和口味偏好为必填项
   - 输入长度限制：最多50个字符
   - 空值检查：确保必填字段不为空

2. **推荐结论处理**:
   - 检查后端返回的 `conclusion` 字段是否存在
   - 如果 `conclusion` 字段为空或不存在，不显示推荐结论区域
   - 支持两种字段名：`conclusion` 和 `recommendation_conclusion`
   - 推荐结论长度建议：20-30字，超出部分自动截断

3. **参数推断异常处理**:
   - 当用户输入无法匹配预设规则时，使用默认推断参数
   - 默认推断参数：
     - hop: "柑橘味、花香"
     - style: "小麦啤、拉格"
     - ibu: "20-40"
     - aroma: 3

3. **模式切换**:
   - 新手模式：隐藏高级参数，自动推断
   - 进阶模式：显示所有参数，用户手动填写

### 后端边界条件

1. **参数验证**:
   - 验证必填参数是否存在
   - 验证参数格式是否正确
   - 验证参数值是否在有效范围内

2. **错误处理**:
   - 返回详细的错误信息
   - 提供错误码和错误描述
   - 记录错误日志便于调试

## 注意事项

1. **隐藏参数处理**:
   - 隐藏参数仅在新手模式下推断并传递
   - 隐藏参数不在任何前端界面元素中显示
   - 隐藏参数的键名需与后端接口参数要求保持一致

2. **参数推断逻辑**:
   - 推断逻辑完全在前端实现
   - 不调用额外后端接口进行推断
   - 推断结果作为隐藏参数附加传递

3. **兼容性**:
   - 接口同时支持新手模式和进阶模式
   - 进阶模式下不执行参数推断逻辑
   - 确保向后兼容性
   - 推荐结论字段为可选字段，不提供时不影响推荐结果展示

4. **推荐结论展示**:
   - 推荐结论显示在酒款标题下方、价格信息上方
   - 样式明显高于普通正文，使用深棕色渐变背景
   - 包含灯泡图标增强视觉效果
   - 仅在后端返回结论字段时显示

5. **性能考虑**:
   - 参数推断在前端快速完成
   - 减少不必要的后端请求
   - 优化用户体验

## 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| 1.1.0 | 2026-01-08 | 新增推荐结论字段（conclusion），支持一句话推荐总结展示 |
| 1.0.0 | 2026-01-08 | 初始版本，支持新手模式和进阶模式的推荐接口 |

## 联系方式

如有问题或建议，请联系开发团队。
